(()=>{"use strict";class e{constructor(e,t){let{data:s,handleCardClick:n}=e;this._name=s.name,this._link=s.link,this._likeCounter=s.like,this._cardTemplate=t,this._handleCardClick=n}_getTemplate(){return document.querySelector(this._cardTemplate).content.querySelector(".element").cloneNode(!0)}_handleLikeClick(e){e.target.classList.toggle("element__like-image_active"),e.target.classList.contains("element__like-image_active")?this._like.textContent++:this._like.textContent--}_handleRemoveClick(){this._element.remove()}_setEventListeners(){this._element.querySelector(".element__like-button").addEventListener("click",this._handleLikeClick.bind(this)),this._element.querySelector(".element__remove-button").addEventListener("click",this._handleRemoveClick.bind(this)),this._element.querySelector(".element__image").addEventListener("click",(()=>{this._handleCardClick(this._name,this._link)}))}renderCard(){return this._element=this._getTemplate(),this._image=this._element.querySelector(".element__image"),this._like=this._element.querySelector(".element__like-counter"),this._like.textContent="0",this._setEventListeners(),this._element.querySelector(".element__title").textContent=this._name,this._image.alt=this._name,this._image.src=this._link,this._element}}class t{constructor(e,t){this._formElement=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_setEventListeners(){Array.from(this._formElement.querySelectorAll(this._inputSelector)).forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))})),this._formElement.addEventListener("submit",(e=>{e.preventDefault()}))}toggleButtonState(){const e=this._formElement.checkValidity();this._buttonElement.disabled=!e,this._buttonElement.classList.toggle(this._inactiveButtonClass,!e)}enableValidation(){this._setEventListeners()}}const s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error"};class n{constructor(e){this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".popup__close-button"),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this._popup.classList.contains("popup_opened")&&this.close()}_handleOverlayClose(e){e.target===e.currentTarget&&this.close()}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._closeButton.addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("mousedown",this._handleOverlayClose.bind(this))}}class o extends n{constructor(e,t){let{handleFormSubmit:s}=t;super(e),this._popupForm=this._popup.querySelector(".popup__form"),this._handleFormSubmit=s,this._inputList=this._popup.querySelectorAll(".popup__input")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}close(){super.close(),this._popupForm.reset()}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}class r{constructor(e,t){let{items:s,renderer:n}=e;this._items=s,this._renderer=n,this._containerSelector=t}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addDefaultItem(e){this._containerSelector.append(e)}addNewItem(e){this._containerSelector.prepend(e)}}document.querySelector(".popup_edit"),document.querySelector(".popup_add");const i=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__avatar"),a=(document.querySelector(".profile__title"),document.querySelector(".profile__subtitle"),document.querySelector(".popup_scale-image"),document.querySelector(".popup__close-button_add"),document.querySelector(".popup__close-button_edit"),document.querySelector(".popup__close-button_image"),document.forms.form__edit),c=document.forms.form__add,u=document.forms.form__avatar,_=a.elements.name,p=a.elements.profession,d=c.elements.title,h=c.elements.link,m=u.elements.avatar,S=document.querySelector(".profile__add-button"),v=document.querySelector(".profile__edit-button"),f=document.querySelector(".elements"),E=(document.querySelector(".popup__caption"),document.querySelector(".popup__image"),new class{constructor(e){this.url=e.url,this.headers=e.headers}getInitialCards(){return fetch(`${this.url}cards`,{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка создания карточек: ${e.status}`)))}createNewCard(e){return fetch(`${this.url}cards`,{headers:this.headers,method:"POST",body:JSON.stringify(e)}).then((e=>{if(e.ok)return e.json();Promise.reject(`Ошибка добавления карточки: ${e.status}`)}))}}({url:"https://mesto.nomoreparties.co/v1/cohort-64/",headers:{authorization:"b92a68e1-9c05-465c-acf6-54138cb2e2f3","Content-Type":"application/json"}}));function C(t){return new e({data:t,handleCardClick:()=>{g.open(t.name,t.link)}},"#card-template").renderCard()}E.getInitialCards().then((e=>{const t=new r({items:e,renderer:e=>{console.log(e);const s=C(e);t.addDefaultItem(s)}},f);t.renderItems()}));const y=new class{constructor(e){let{nameSelector:t,infoSelector:s}=e;this._nameSelector=document.querySelector(t),this._infoSelector=document.querySelector(s)}getUserInfo(){return{name:this._nameSelector.textContent,profession:this._infoSelector.textContent}}setUserInfo(e,t){this._nameSelector.textContent=e,this._infoSelector.textContent=t}}({nameSelector:".profile__title",infoSelector:".profile__subtitle"}),g=new class extends n{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._caption=this._popup.querySelector(".popup__caption")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._caption.textContent=e}}(".popup_scale-image");g.setEventListeners();const k=new o(".popup_edit",{handleFormSubmit:e=>{y.setUserInfo(e.name,e.profession),k.close()}});k.setEventListeners(),v.addEventListener("click",(()=>{k.open();const e=y.getUserInfo();_.value=e.name,p.value=e.profession}));const b=new o(".popup_add",{handleFormSubmit:()=>{const e={name:d.value,link:h.value};E.createNewCard(C(e)).then((e=>{console.log(e)})),b.close()}});b.setEventListeners(),S.addEventListener("click",(()=>{b.open(),w.toggleButtonState()}));const L=new o(".popup_update-avatar",{handleFormSubmit:()=>{l.src=m.value,L.close()}});L.setEventListeners(),i.addEventListener("click",(()=>{L.open(),I.toggleButtonState()}));const q=new o(".popup_confirmation",{handleFormSubmit:()=>{}});q.setEventListeners(),new t(s,a).enableValidation();const w=new t(s,c);w.enableValidation();const I=new t(s,u);I.enableValidation(),document.querySelector(".header__logo").addEventListener("click",(()=>{q.open()}))})();